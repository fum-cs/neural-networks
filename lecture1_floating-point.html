
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Floating Point Numbers &#8212; NN</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'lecture1_floating-point';</script>
    <link rel="icon" href="_static/fum-logo.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Regression" href="lecture2_1_regression.html" />
    <link rel="prev" title="Introduction to the Course" href="lecture0_introduction.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/fum-cs-logo.png" class="logo__image only-light" alt="NN - Home"/>
    <script>document.write(`<img src="_static/fum-cs-logo.png" class="logo__image only-dark" alt="NN - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="index.html">
                    Neural Networks
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="lecture0_introduction.html">Introduction to the Course</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Floating Point Numbers</a></li>
<li class="toctree-l1"><a class="reference internal" href="lecture2_1_regression.html">Regression</a></li>



<li class="toctree-l1"><a class="reference internal" href="lecture2_2_gradient-descent.html">Gradient Descent</a></li>
<li class="toctree-l1"><a class="reference internal" href="lecture2_3_stochastic-gradient-descent.html">Stochastic Gradient Descent</a></li>
<li class="toctree-l1"><a class="reference internal" href="lecture3_neural-networks-basics.html">Introduction to Pytorch &amp; Neural Networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="lecture4_neural-networks-for-classification.html">Neural Networks for Classification</a></li>
<li class="toctree-l1"><a class="reference internal" href="lecture5_neural-networks-regularization.html">Regularization and Dropout in Neural Networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="lecture6_cnns-pt1.html">Introduction to Convolutional Neural Networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="lecture7_cnns-pt2.html">Advanced Convolutional Neural Networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="lecture8_advanced-deep-learning.html">Advanced Deep Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="appendixA_gradients.html">Appendix A: Gradients Review</a></li>

<li class="toctree-l1"><a class="reference internal" href="appendixB_logistic-loss.html">Appendix B: Logistic Loss</a></li>
<li class="toctree-l1"><a class="reference internal" href="appendixC_computing-derivatives.html">Appendix C: Computing Derivatives</a></li>
<li class="toctree-l1"><a class="reference internal" href="appendixD_tensor-basics.html">Appendix D: Basics of Numpy and Tensors</a></li>
<li class="toctree-l1"><a class="reference internal" href="appendixE_pytorch-autograd.html">Appendix E: Auto Differentiation</a></li>
<li class="toctree-l1"><a class="reference internal" href="appendixF_pytorch-optimizers.html">Appendix F: Optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="appendixG_bitmoji-CNN.html">Appendix G: Creating a CNN to Predict Bitmojis</a></li>
<li class="toctree-l1"><a class="reference internal" href="appendixH_transposed_conv.html">Transposed Convolution</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/fum-cs/neural-networks/blob/main/notebooks/lecture1_floating-point.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Colab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Colab logo" src="_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/fum-cs/neural-networks" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/fum-cs/neural-networks/issues/new?title=Issue%20on%20page%20%2Flecture1_floating-point.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/lecture1_floating-point.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Floating Point Numbers</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lecture-outline">Lecture Outline</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lecture-learning-objectives">Lecture Learning Objectives</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">Imports</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#floating-point-errors">1. Floating Point Errors</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#binary-numbers-and-integers">2. Binary Numbers and Integers</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fractional-numbers-in-binary">3. Fractional Numbers in Binary</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fixed-point-numbers">4. Fixed Point Numbers</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">5. Floating Point Numbers</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#floating-point-standard">5.1. Floating Point Standard</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#spacing-and-rounding-errors">6. Spacing and Rounding Errors</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ingredient-1-rounding-errors">6.1. Ingredient 1: Rounding Errors</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ingredient-2-spacing">6.2. Ingredient 2: Spacing</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lecture-exercise-fun-with-floating-points">7. Lecture Exercise: Fun with Floating Points</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#floating-point-range">7.1. Floating Point Range</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#optional-7-1-1-subnormal-numbers">(Optional) 7.1.1 Subnormal Numbers</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#order-of-operations">7.2. Order of Operations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#writing-functions">7.3. Writing Functions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#precision-vs-memory-vs-speed">7.4. Precision vs Memory vs Speed</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-lecture-in-three-conjectures">8. The Lecture in Three Conjectures</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <p><img alt="" src="_images/572_banner.png" /></p>
<script src="require.js"></script><section class="tex2jax_ignore mathjax_ignore" id="floating-point-numbers">
<h1>Floating Point Numbers<a class="headerlink" href="#floating-point-numbers" title="Link to this heading">#</a></h1>
<p><strong>Mahmood Amintoosi, Spring 2024</strong></p>
<p>Computer Science Dept, Ferdowsi University of Mashhad</p>
<p>I should mention that the original material was from <a class="reference external" href="https://ubc-mds.github.io/DSCI_572_sup-learn-2">Tomas Beuzen’s course</a>.</p>
<p><img alt="" src="_images/floating.png" /></p>
<section id="lecture-outline">
<h2>Lecture Outline<a class="headerlink" href="#lecture-outline" title="Link to this heading">#</a></h2>
<hr><div class="toc"><ul class="toc-item"><li><span><a href="#Lecture-Learning-Objectives" data-toc-modified-id="Lecture-Learning-Objectives-2">Lecture Learning Objectives</a></span></li><li><span><a href="#Imports" data-toc-modified-id="Imports-3">Imports</a></span></li><li><span><a href="#1.-Floating-Point-Errors" data-toc-modified-id="1.-Floating-Point-Errors-4">1. Floating Point Errors</a></span></li><li><span><a href="#2.-Binary-Numbers-and-Integers" data-toc-modified-id="2.-Binary-Numbers-and-Integers-5">2. Binary Numbers and Integers</a></span></li><li><span><a href="#3.-Fractional-Numbers-in-Binary" data-toc-modified-id="3.-Fractional-Numbers-in-Binary-6">3. Fractional Numbers in Binary</a></span></li><li><span><a href="#4.-Fixed-Point-Numbers" data-toc-modified-id="4.-Fixed-Point-Numbers-7">4. Fixed Point Numbers</a></span></li><li><span><a href="#5.-Floating-Point-Numbers" data-toc-modified-id="5.-Floating-Point-Numbers-8">5. Floating Point Numbers</a></span></li><li><span><a href="#6.-Spacing-and-Rounding-Errors" data-toc-modified-id="6.-Spacing-and-Rounding-Errors-9">6. Spacing and Rounding Errors</a></span></li><li><span><a href="#7.-Lecture-Exercise:-Fun-with-Floating-Points" data-toc-modified-id="7.-Lecture-Exercise:-Fun-with-Floating-Points-10">7. Lecture Exercise: Fun with Floating Points</a></span></li><li><span><a href="#8.-The-Lecture-in-Three-Conjectures" data-toc-modified-id="8.-The-Lecture-in-Three-Conjectures-11">8. The Lecture in Three Conjectures</a></span></li></ul></div></section>
<section id="lecture-learning-objectives">
<h2>Lecture Learning Objectives<a class="headerlink" href="#lecture-learning-objectives" title="Link to this heading">#</a></h2>
<hr><ul class="simple">
<li><p>Compare and contrast the representations of integers and floating point numbers</p></li>
<li><p>Explain how double-precision floating point numbers are represented by 64 bits</p></li>
<li><p>Identify common computational issues caused by floating point numbers, e.g., rounding, overflow, etc.</p></li>
<li><p>Calculate the “spacing” of a 64 bit floating point number in Python</p></li>
<li><p>Write code defensively against numerical errors</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">numpy.iinfo()</span></code>/<code class="docutils literal notranslate"><span class="pre">numpy.finfo()</span></code> to work out the possible numerical range of an integer or float dtype</p></li>
</ul>
</section>
<section id="imports">
<h2>Imports<a class="headerlink" href="#imports" title="Link to this heading">#</a></h2>
<hr><div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Auto-setup when running on Google Colab</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="k">if</span> <span class="s1">&#39;google.colab&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">get_ipython</span><span class="p">())</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;/content/neural-networks&#39;</span><span class="p">):</span>
    <span class="o">!</span>git<span class="w"> </span>clone<span class="w"> </span>-q<span class="w"> </span>https://github.com/fum-cs/neural-networks.git<span class="w"> </span>/content/neural-networks
    <span class="o">!</span>pip<span class="w"> </span>--quiet<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>/content/neural-networks/requirements_colab.txt
    <span class="o">%</span><span class="k">cd</span> neural-networks/notebooks
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">utils.floating_point</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">plotly.io</span> <span class="k">as</span> <span class="nn">pio</span>
<span class="n">pio</span><span class="o">.</span><span class="n">renderers</span><span class="o">.</span><span class="n">default</span> <span class="o">=</span> <span class="s1">&#39;notebook&#39;</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="floating-point-errors">
<h2>1. Floating Point Errors<a class="headerlink" href="#floating-point-errors" title="Link to this heading">#</a></h2>
<hr><ul class="simple">
<li><p>Unfortunately, computers can not always represent numbers as accurately as some of us might think</p></li>
<li><p>The problem boils down to this: we have a finite amount of bits in our computer to store an infinite amount of numbers</p></li>
<li><p>This inevitably leads to precision errors as we’ll explore in this lecture</p></li>
<li><p>Some motivating examples:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mf">0.1</span> <span class="o">+</span> <span class="mf">0.2</span> <span class="o">==</span> <span class="mf">0.3</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>False
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mf">1e16</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="mf">1e16</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>In this lecture, we are going to take a journey to discover why this happens!</p></li>
</ul>
</section>
<section id="binary-numbers-and-integers">
<h2>2. Binary Numbers and Integers<a class="headerlink" href="#binary-numbers-and-integers" title="Link to this heading">#</a></h2>
<hr><ul class="simple">
<li><p>We are used to using a base-10 number system (i.e., “decimal” or “denary”)</p></li>
<li><p>For example, we can read the number 104 as:</p>
<ul>
<li><p>4 x 1   (<span class="math notranslate nohighlight">\(10^0\)</span>)</p></li>
<li><p>0 x 10  (<span class="math notranslate nohighlight">\(10^1\)</span>)</p></li>
<li><p>1 x 100 (<span class="math notranslate nohighlight">\(10^2\)</span>)</p></li>
</ul>
</li>
<li><p>Or in a tabular format:</p></li>
</ul>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head text-left"><p>Unit</p></th>
<th class="head text-left"><p><span class="math notranslate nohighlight">\(10^2\)</span></p></th>
<th class="head text-left"><p><span class="math notranslate nohighlight">\(10^1\)</span></p></th>
<th class="head text-left"><p><span class="math notranslate nohighlight">\(10^0\)</span></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>Value</p></td>
<td class="text-left"><p>100</p></td>
<td class="text-left"><p>10</p></td>
<td class="text-left"><p>1</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Number of units</p></td>
<td class="text-left"><p>1</p></td>
<td class="text-left"><p>0</p></td>
<td class="text-left"><p>4</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><strong>Total</strong></p></td>
<td class="text-left"><p><strong>100</strong></p></td>
<td class="text-left"><p><strong>0</strong></p></td>
<td class="text-left"><p><strong>4</strong></p></td>
</tr>
</tbody>
</table>
</div>
<ul class="simple">
<li><p>Many of you will be aware that computers use a base-2 system (i.e., “binary”) to store data</p></li>
<li><p>Binary is based on powers of 2 rather than powers of 10 and we only have two numbers (0 and 1) to work with (think of them as “off” and “on” switches respectively)</p></li>
<li><p>If you’re interested in learning more about how computers work under the hood, check out <a class="reference external" href="https://www.youtube.com/playlist?list=PL8dPuuaLjXtNlUrzyH5r6jN9ulIgZBpdo&amp;amp;app=desktop">this excellent Youtube series on computer science by CrashCourse</a></p></li>
<li><p>In binary, 104 looks like:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="mi">104</span><span class="si">:</span><span class="s2">b</span><span class="si">}</span><span class="s2">&quot;</span>  <span class="c1"># I&#39;m using the python f-string format code &quot;b&quot; to display my integer in binary</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;1101000&#39;
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>So this is:</p></li>
</ul>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head text-left"><p>Unit</p></th>
<th class="head text-left"><p><span class="math notranslate nohighlight">\(2^6\)</span></p></th>
<th class="head text-left"><p><span class="math notranslate nohighlight">\(2^5\)</span></p></th>
<th class="head text-left"><p><span class="math notranslate nohighlight">\(2^4\)</span></p></th>
<th class="head text-left"><p><span class="math notranslate nohighlight">\(2^3\)</span></p></th>
<th class="head text-left"><p><span class="math notranslate nohighlight">\(2^2\)</span></p></th>
<th class="head text-left"><p><span class="math notranslate nohighlight">\(2^1\)</span></p></th>
<th class="head text-left"><p><span class="math notranslate nohighlight">\(2^0\)</span></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>Value</p></td>
<td class="text-left"><p>64</p></td>
<td class="text-left"><p>32</p></td>
<td class="text-left"><p>16</p></td>
<td class="text-left"><p>8</p></td>
<td class="text-left"><p>4</p></td>
<td class="text-left"><p>2</p></td>
<td class="text-left"><p>1</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Number of units</p></td>
<td class="text-left"><p>1</p></td>
<td class="text-left"><p>1</p></td>
<td class="text-left"><p>0</p></td>
<td class="text-left"><p>1</p></td>
<td class="text-left"><p>0</p></td>
<td class="text-left"><p>0</p></td>
<td class="text-left"><p>0</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><strong>Total</strong></p></td>
<td class="text-left"><p><strong>64</strong></p></td>
<td class="text-left"><p><strong>32</strong></p></td>
<td class="text-left"><p><strong>0</strong></p></td>
<td class="text-left"><p><strong>8</strong></p></td>
<td class="text-left"><p><strong>0</strong></p></td>
<td class="text-left"><p><strong>0</strong></p></td>
<td class="text-left"><p><strong>0</strong></p></td>
</tr>
</tbody>
</table>
</div>
<ul class="simple">
<li><p>We call these single binary 0/1 values, <strong>bits</strong></p></li>
<li><p>So we needed 7 bits to represent the number 104</p></li>
<li><p>We can confirm using the <code class="docutils literal notranslate"><span class="pre">.bit_length()</span></code> integer method</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="mi">104</span>
<span class="n">x</span><span class="o">.</span><span class="n">bit_length</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>7
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Here are the first 10 positive integers in binary (using 4 bits):</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DECIMAL | BINARY&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;================&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">11</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   </span><span class="si">{</span><span class="n">_</span><span class="si">:</span><span class="s2">02</span><span class="si">}</span><span class="s2">   |  </span><span class="si">{</span><span class="n">_</span><span class="si">:</span><span class="s2">04b</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DECIMAL | BINARY
================
   00   |  0000
   01   |  0001
   02   |  0010
   03   |  0011
   04   |  0100
   05   |  0101
   06   |  0110
   07   |  0111
   08   |  1000
   09   |  1001
   10   |  1010
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>And a useful GIF counting up in binary to drive the point home:</p></li>
</ul>
<p><img alt="" src="_images/binary-denary.gif" /></p>
<p>Source: <a class="reference external" href="https://www.futurelearn.com/courses/how-computers-work/0/steps/49261">futurelearn.com</a></p>
<ul class="simple">
<li><p>Any integer can be represented in binary (if we have enough bits)</p></li>
<li><p>The range of <em>unsigned integers</em> we can represent with <code class="docutils literal notranslate"><span class="pre">N</span></code> bits is: 0 to <span class="math notranslate nohighlight">\(2^{N}-1\)</span></p></li>
<li><p>We often reserve one bit to specify the sign (- or +) of a number, so the range of <em>signed integers</em> you can represent with <code class="docutils literal notranslate"><span class="pre">N</span></code> bits is: <span class="math notranslate nohighlight">\(-2^{N-1}\)</span> to <span class="math notranslate nohighlight">\(2^{N-1}-1\)</span></p></li>
<li><p>For example, with 8 bits we can represent the unsigned integers 0 to 255, <em>or</em> the signed integers -128 to 127:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bits</span> <span class="o">=</span> <span class="mi">8</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;unsigned min: 0&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;unsigned max: </span><span class="si">{</span><span class="mi">2</span><span class="w"> </span><span class="o">**</span><span class="w"> </span><span class="n">bits</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;signed min: </span><span class="si">{</span><span class="o">-</span><span class="mi">2</span><span class="w"> </span><span class="o">**</span><span class="w"> </span><span class="p">(</span><span class="n">bits</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;signed max: </span><span class="si">{</span><span class="mi">2</span><span class="w"> </span><span class="o">**</span><span class="w"> </span><span class="p">(</span><span class="n">bits</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>unsigned min: 0
unsigned max: 255

signed min: -128
signed max: 127
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>We can confirm all this with the numpy function <code class="docutils literal notranslate"><span class="pre">np.iinfo()</span></code>:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="s2">&quot;int8&quot;</span><span class="p">)</span>  <span class="c1"># use np.iinfo() to check out the limits of a dtype</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>iinfo(min=-128, max=127, dtype=int8)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>  <span class="c1"># &quot;uint8&quot; is an unsigned 8-bit integer, so ranging from 0 to 2^7</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>iinfo(min=0, max=255, dtype=uint8)
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Depending on the language/library you’re using, you may get an error or some other funky behaviour if you try to store an integer smaller/larger than the allowable</p></li>
<li><p>In the case of <code class="docutils literal notranslate"><span class="pre">numpy</span></code>, it will loop around and continue counting from the upper/lower limit</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">87</span><span class="p">,</span> <span class="mi">31</span><span class="p">],</span> <span class="s2">&quot;int8&quot;</span><span class="p">)</span>  <span class="c1"># this is fine as all numbers with the allowable range of int8</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([-87,  31], dtype=int8)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">129</span><span class="p">,</span> <span class="mi">128</span><span class="p">],</span> <span class="s2">&quot;int8&quot;</span><span class="p">)</span>  <span class="c1"># these numbers are outside the allowable range!</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\mathp\AppData\Local\Temp\ipykernel_20776\443777753.py:1: DeprecationWarning:

NumPy will stop allowing conversion of out-of-bound Python integers to integer arrays.  The conversion of -129 to int8 will fail in the future.
For the old behavior, usually:
    np.array(value).astype(dtype)
will give the desired result (the cast overflows).

C:\Users\mathp\AppData\Local\Temp\ipykernel_20776\443777753.py:1: DeprecationWarning:

NumPy will stop allowing conversion of out-of-bound Python integers to integer arrays.  The conversion of 128 to int8 will fail in the future.
For the old behavior, usually:
    np.array(value).astype(dtype)
will give the desired result (the cast overflows).
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ 127, -128], dtype=int8)
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>To store the above, we need more bits (memory)</p></li>
<li><p>For example, 16 bits will be more than enough:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">129</span><span class="p">,</span> <span class="mi">128</span><span class="p">],</span> <span class="s2">&quot;int16&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([-129,  128], dtype=int16)
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>You often see bits in multiples of 8 (e.g., 8, 16, 32, 64, etc)</p></li>
<li><p>8 bits is traditionally called 1 “byte”</p></li>
</ul>
<blockquote>
<div><p>Note that the Python default <code class="docutils literal notranslate"><span class="pre">int</span></code> has 64-bits, so a range of <span class="math notranslate nohighlight">\(-2^{63}\)</span> to <span class="math notranslate nohighlight">\(2^{63} - 1\)</span>. But Python is special in that it can dynamically allocate more memory to hold your integer if needed, but that’s not really important for us right now.</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">**</span> <span class="mi">64</span>
<span class="n">x</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>18446744073709551616
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="o">.</span><span class="n">bit_length</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>65
</pre></div>
</div>
</div>
</div>
<p>🤔</p>
</section>
<section id="fractional-numbers-in-binary">
<h2>3. Fractional Numbers in Binary<a class="headerlink" href="#fractional-numbers-in-binary" title="Link to this heading">#</a></h2>
<hr><ul class="simple">
<li><p>At this point you might be thinking, “Well that’s all well and good for integers, but what about fractional numbers like 14.75 Tom?” - Good question!</p></li>
<li><p>Let’s interpret the number 14.75 in our familiar decimal format</p></li>
</ul>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head text-left"><p>Unit</p></th>
<th class="head text-left"><p><span class="math notranslate nohighlight">\(10^1\)</span></p></th>
<th class="head text-left"><p><span class="math notranslate nohighlight">\(10^0\)</span></p></th>
<th class="head text-left"><p><span class="math notranslate nohighlight">\(10^{-1}\)</span></p></th>
<th class="head text-left"><p><span class="math notranslate nohighlight">\(10^{-2}\)</span></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>Value</p></td>
<td class="text-left"><p>10</p></td>
<td class="text-left"><p>1</p></td>
<td class="text-left"><p>0.1</p></td>
<td class="text-left"><p>0.01</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Number of units</p></td>
<td class="text-left"><p>1</p></td>
<td class="text-left"><p>4</p></td>
<td class="text-left"><p>7</p></td>
<td class="text-left"><p>5</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><strong>Total</strong></p></td>
<td class="text-left"><p><strong>10</strong></p></td>
<td class="text-left"><p><strong>4</strong></p></td>
<td class="text-left"><p><strong>0.7</strong></p></td>
<td class="text-left"><p><strong>0.05</strong></p></td>
</tr>
</tbody>
</table>
</div>
<ul class="simple">
<li><p>That seems pretty natural, and in binary it’s much the same!</p></li>
<li><p>Anything to the right of the decimal point (now called a “binary point”) is treated with a <strong>negative exponent</strong></p></li>
<li><p>So in binary, 14.75 would look like this: 1110.11</p></li>
<li><p>Let’s break that down:</p></li>
</ul>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head text-left"><p>Unit</p></th>
<th class="head text-left"><p><span class="math notranslate nohighlight">\(2^3\)</span></p></th>
<th class="head text-left"><p><span class="math notranslate nohighlight">\(2^2\)</span></p></th>
<th class="head text-left"><p><span class="math notranslate nohighlight">\(2^1\)</span></p></th>
<th class="head text-left"><p><span class="math notranslate nohighlight">\(2^0\)</span></p></th>
<th class="head text-left"><p><span class="math notranslate nohighlight">\(2^{-1}\)</span></p></th>
<th class="head text-left"><p><span class="math notranslate nohighlight">\(2^{-2}\)</span></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>Value</p></td>
<td class="text-left"><p>8</p></td>
<td class="text-left"><p>4</p></td>
<td class="text-left"><p>2</p></td>
<td class="text-left"><p>1</p></td>
<td class="text-left"><p>0.5</p></td>
<td class="text-left"><p>0.25</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Number of units</p></td>
<td class="text-left"><p>1</p></td>
<td class="text-left"><p>1</p></td>
<td class="text-left"><p>1</p></td>
<td class="text-left"><p>0</p></td>
<td class="text-left"><p>1</p></td>
<td class="text-left"><p>1</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><strong>Total</strong></p></td>
<td class="text-left"><p><strong>8</strong></p></td>
<td class="text-left"><p><strong>4</strong></p></td>
<td class="text-left"><p><strong>2</strong></p></td>
<td class="text-left"><p><strong>0</strong></p></td>
<td class="text-left"><p><strong>0.5</strong></p></td>
<td class="text-left"><p><strong>0.25</strong></p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="fixed-point-numbers">
<h2>4. Fixed Point Numbers<a class="headerlink" href="#fixed-point-numbers" title="Link to this heading">#</a></h2>
<hr><ul class="simple">
<li><p>As we learned earlier, we typically have a fixed number of bits to work with when storing a number, e.g., 8, 16, 32, 64 bits etc.</p></li>
<li><p>How do we decide where to put the binary point to allow for fractional numbers?</p></li>
<li><p>With 8 bits, we could put 4 bits on the left and 4 on the right:</p></li>
</ul>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Unit</p></th>
<th class="head"><p><span class="math notranslate nohighlight">\(2^3\)</span></p></th>
<th class="head"><p><span class="math notranslate nohighlight">\(2^2\)</span></p></th>
<th class="head"><p><span class="math notranslate nohighlight">\(2^1\)</span></p></th>
<th class="head"><p><span class="math notranslate nohighlight">\(2^0\)</span></p></th>
<th class="head"><p><span class="math notranslate nohighlight">\(2^{-1}\)</span></p></th>
<th class="head"><p><span class="math notranslate nohighlight">\(2^{-2}\)</span></p></th>
<th class="head"><p><span class="math notranslate nohighlight">\(2^{-3}\)</span></p></th>
<th class="head"><p><span class="math notranslate nohighlight">\(2^{-4}\)</span></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Value</p></td>
<td><p>8</p></td>
<td><p>4</p></td>
<td><p>2</p></td>
<td><p>1</p></td>
<td><p>0.5</p></td>
<td><p>0.25</p></td>
<td><p>0.125</p></td>
<td><p>0.0625</p></td>
</tr>
</tbody>
</table>
</div>
<ul class="simple">
<li><p>In this case, the largest and smallest (closest to 0) numbers we could represent in the unsigned case are:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mf">2.0</span> <span class="o">**</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>15.9375
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mi">2</span> <span class="o">**</span> <span class="o">-</span><span class="mi">4</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0625
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>But what if we wanted to represent numbers larger than this?</p></li>
<li><p>We could shift the binary point right, so we have 6 on the left and 2 on the right, then our range would be:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mf">2.0</span> <span class="o">**</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>63.75
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mi">2</span> <span class="o">**</span> <span class="o">-</span><span class="mi">2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.25
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>We get this trade-off between being able to represent large numbers and small numbers</p></li>
<li><p>What if we want to represent both very large and very small numbers? Read on…</p></li>
</ul>
</section>
<section id="id1">
<h2>5. Floating Point Numbers<a class="headerlink" href="#id1" title="Link to this heading">#</a></h2>
<hr><ul class="simple">
<li><p>At this point, you may have read “floating point” and had a little “ah-ha!” moment because you see where we’re going</p></li>
<li><p>Rather than having a fixed location for our binary point, we could let it “float” around depending on what number we want to store</p></li>
<li><p>Recall “scientific notation”, which for the number 1234 looks like <span class="math notranslate nohighlight">\(1.234 \times 10^3\)</span>, or for computers we usually use <code class="docutils literal notranslate"><span class="pre">e</span></code> for shorthand:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="mi">1234</span><span class="si">:</span><span class="s2">.3e</span><span class="si">}</span><span class="s2">&quot;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;1.234e+03&#39;
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>The “exponent” controls the location of the decimal point</p></li>
<li><p>Consider the following numbers:</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(1.234 \times 10^0 = 1.234\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(1.234 \times 10^1 = 12.34\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(1.234 \times 10^2 = 123.4\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(1.234 \times 10^3 = 1234.\)</span></p></li>
</ul>
</li>
<li><p>See how by changing the value of the exponent we can control the location of the floating point and represent a range of values?</p></li>
<li><p>We’ll be using the exact same logic with the binary system to come up with our “floating point numbers”</p></li>
<li><p>This is floating point format:</p></li>
</ul>
<div class="math notranslate nohighlight">
\[1.M \times 2^E\]</div>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(M\)</span> = “mantissa”</p></li>
<li><p><span class="math notranslate nohighlight">\(E\)</span> = “exponent”</p></li>
<li><p>Note that the <span class="math notranslate nohighlight">\(.\)</span> is a “binary point”, digits on the left are 2’s with +ve exponents, digits on the right are 2’s with negative exponents</p></li>
</ul>
<ul class="simple">
<li><p>Consider the number 10</p></li>
<li><p><span class="math notranslate nohighlight">\(10 = 1.25 \times 8 = 1.25 \times 2^3\)</span></p></li>
<li><p>So <span class="math notranslate nohighlight">\(M=.25\)</span> and <span class="math notranslate nohighlight">\(E=3\)</span></p></li>
<li><p>But we want binary, not decimal, so <span class="math notranslate nohighlight">\(M=01\)</span> and <span class="math notranslate nohighlight">\(E=11\)</span></p></li>
<li><p>Therefore, 10 in floating point is: <span class="math notranslate nohighlight">\(1.01 \times 2^{11}\)</span></p></li>
<li><p>This is where the magic happens, just as the exponent of 10 in scientific notation defines the location of the decimal point, so too does the exponent of a floating point number define the location of the binary point</p></li>
<li><p>For <span class="math notranslate nohighlight">\(1.01 \times 2^{11}\)</span>, the exponent is 11 in binary = 3 in decimal, so move the binary point three places to the right: <span class="math notranslate nohighlight">\(1.01 \times 2^{11} = 1010.\)</span></p></li>
<li><p>What is 1010 in binary?</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span><span class="p">(</span><span class="s2">&quot;1010&quot;</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>10
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>It’s 10 of course!</p></li>
<li><p>How cool is that - we now have this “floating point” data type that uses an exponent to help us represent both small and large fractional numbers (unlike fixed point where we would have to choose one or the other!)</p></li>
<li><p>I wrote a function <code class="docutils literal notranslate"><span class="pre">binary()</span></code> to display any number in floating point format:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">binary</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> Decimal: 1.25 x 2^3
  Binary: 1.01 x 2^11

    Sign: 0 (+)
Mantissa: 01 (0.25)
Exponent: 11 (3)
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Let’s try the speed of light: <span class="math notranslate nohighlight">\(2.998 \times 10 ^ 8 m/s\)</span></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">binary</span><span class="p">(</span><span class="mf">2.998e8</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> Decimal: 1.11684203147888184 x 2^28
  Binary: 1.0001110111101001010111 x 2^11100

    Sign: 0 (+)
Mantissa: 0001110111101001010111 (0.11684203147888184)
Exponent: 11100 (28)
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>A mole: <span class="math notranslate nohighlight">\(6.02214076 \times 10^{23} particles\)</span></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">binary</span><span class="p">(</span><span class="mf">6.02214076e23</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> Decimal: 1.9925592330949422 x 2^78
  Binary: 1.1111111000011000010111001010010101111100010100010111 x 2^1001110

    Sign: 0 (+)
Mantissa: 1111111000011000010111001010010101111100010100010111 (0.9925592330949422)
Exponent: 1001110 (78)
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Planck’s constant: <span class="math notranslate nohighlight">\(6.62607004 \times 10^{-34} m^2 kg / s\)</span></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">binary</span><span class="p">(</span><span class="mf">6.62607004e-34</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> Decimal: 1.720226132656187 x 2^-111
  Binary: 1.1011100001100000101111010110010101111011100111100001 x 2^-1101111

    Sign: 0 (+)
Mantissa: 1011100001100000101111010110010101111011100111100001 (0.720226132656187)
Exponent: -1101111 (-111)
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>You get the point, we can represent a wide range of numbers with this format! (we’ll work out the exact range later on)</p></li>
</ul>
<section id="floating-point-standard">
<h3>5.1. Floating Point Standard<a class="headerlink" href="#floating-point-standard" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>One question you might have about the above: how many bits should I use for the mantissa and how many for the exponent?</p></li>
<li><p>Well that’s already been decided for you in: IEEE Standard for Floating-Point Arithmetic (<a class="reference external" href="https://en.wikipedia.org/wiki/IEEE_754">IEEE 754</a>) which is what most computers/software use</p></li>
<li><p>You’ll mostly be using the data types <code class="docutils literal notranslate"><span class="pre">float64</span></code> and <code class="docutils literal notranslate"><span class="pre">float32</span></code></p></li>
<li><p>Float 64 (also called “double precision”)</p>
<ul>
<li><p>53 bits for the mantissa</p></li>
<li><p>11 bits for the exponent</p></li>
</ul>
</li>
<li><p>Float 32 (also called “single precision”)</p>
<ul>
<li><p>24 bits for the mantissa</p></li>
<li><p>8 bits for the exponent</p></li>
</ul>
</li>
</ul>
</section>
</section>
<section id="spacing-and-rounding-errors">
<h2>6. Spacing and Rounding Errors<a class="headerlink" href="#spacing-and-rounding-errors" title="Link to this heading">#</a></h2>
<hr><section id="ingredient-1-rounding-errors">
<h3>6.1. Ingredient 1: Rounding Errors<a class="headerlink" href="#ingredient-1-rounding-errors" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Many fractional numbers can’t be represented exactly using binary</p></li>
<li><p><strong>Instead, your computer will round numbers to the closest representable number and we get rounding errors</strong></p></li>
<li><p>For example 0.1 can’t be exactly represented in binary (feel free to try and make 0.1 using floating point format).</p></li>
<li><p>Python usually hides this fact for us out of convenience, but here is “<em>the real 0.1</em>”:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="mf">0.1</span><span class="si">:</span><span class="s2">.60f</span><span class="si">}</span><span class="s2">&quot;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;0.100000000000000005551115123125782702118158340454101562500000&#39;
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>So 0.1 is actually represented as a number slightly bigger than 0.1!</p></li>
<li><p>I wrote a function to work out if a number is stored exactly or inexactly, and to show the rounding error:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">float_rep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>You entered: 0.1
Which is inexactly stored as: 0.1000000000000000055511151231257827021181583404541015625
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">float_rep</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>You entered: 0.25
Which is exactly stored as: 0.25
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Read more about float representation in the Python docs <a class="reference external" href="https://docs.python.org/3/tutorial/floatingpoint.html">here</a>.</p></li>
</ul>
</section>
<section id="ingredient-2-spacing">
<h3>6.2. Ingredient 2: Spacing<a class="headerlink" href="#ingredient-2-spacing" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>So how bad are these rounding errors? Let’s find out…</p></li>
<li><p>We can quantify the “spacing” between representable numbers</p></li>
<li><p>Imagine we’re in the decimal system again. For a number with a fixed amount of significant digits, the spacing between that number and the next biggest number with the same format can be determined as the smallest significant digit multipled by the exponent:</p></li>
</ul>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Number</p></th>
<th class="head"><p>Next Largest</p></th>
<th class="head"><p>Spacing</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>8.982e0</p></td>
<td><p>8.983e0</p></td>
<td><p>0.001e0 = 0.001</p></td>
</tr>
<tr class="row-odd"><td><p>0.001e1</p></td>
<td><p>0.002e1</p></td>
<td><p>0.001e1 = 0.01</p></td>
</tr>
<tr class="row-even"><td><p>3.423e2</p></td>
<td><p>3.424e2</p></td>
<td><p>0.001e2 = 0.1</p></td>
</tr>
</tbody>
</table>
</div>
<ul class="simple">
<li><p>Same goes for our binary floating point numbers!</p></li>
<li><p>The spacing can be determined as the smallest part of the mantissa multiplied by a number’s exponent</p></li>
<li><p>What is the smallest part of the mantissa?</p></li>
<li><p>For <code class="docutils literal notranslate"><span class="pre">float64</span></code>, we have 53 bits for the mantissa, 1 bit is reserved for the sign, so we have 52 left, therefore the smallest significant digit is <span class="math notranslate nohighlight">\(2^{-52}\)</span></p></li>
<li><p>To be super clear, here is the floating point format written as powers of 2 for all 52 mantissa bits and 11 exponent bits:</p></li>
</ul>
<div class="math notranslate nohighlight">
\[2^0{}.{}2^{-1}2^{-2}2^{-3}...{}2^{-50}2^{-51}\boldsymbol{2^{-52}} \times 2 ^ {2^{0}2^{1}2^{2}...{}2^{9}2^{10}2^{11}}\]</div>
<ul class="simple">
<li><p>See how <span class="math notranslate nohighlight">\(2^{-52}\)</span> is the smallest value we can change?</p></li>
<li><p>Consider the number 1 in binary:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">binary</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> Decimal: 1.0 x 2^0
  Binary: 1.0 x 2^0

    Sign: 0 (+)
Mantissa: 0 (0.0)
Exponent: 0 (0)
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>As you can see, the number 1 has has an exponent of 0</p></li>
<li><p>Remember the smallest significant digit scaled by our exponent gives us the spacing between this number, and the next number we can represent with our format</p></li>
<li><p>So for the number 1, the spacing is <span class="math notranslate nohighlight">\(2^{-52} * 2^0\)</span></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="o">-</span><span class="mi">52</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2.220446049250313e-16
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Numpy has a helpful function we can use to calculate spacing</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">np.nextafter(x1,</span> <span class="pre">x2)</span></code> returns the next representable floating-point value after <code class="docutils literal notranslate"><span class="pre">x1</span></code> towards <code class="docutils literal notranslate"><span class="pre">x2</span></code></p></li>
<li><p>The next representable number after 1 should be 1 plus the spacing above, let’s check:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">nextafter</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.0000000000000002
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">spacing</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nextafter</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
<span class="n">spacing</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2.220446049250313e-16
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">spacing</span> <span class="o">==</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="o">-</span><span class="mi">52</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>If you do a calculation that puts you somewhere between the <strong>space</strong> of two numbers, the computer will automatically round to the nearest one</p></li>
<li><p>I like to think of this as a mountain range in the computer</p></li>
<li><p>In the valleys are representable numbers, if a calculation puts us on a mountain side, we’ll roll down the mountain to the closest valley</p></li>
<li><p>For example, spacing for the number 1 is <span class="math notranslate nohighlight">\(2^{-52}\)</span>, so if we don’t add at least half that, we won’t reach the next representable number:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mi">1</span> <span class="o">+</span> <span class="mf">0.4</span> <span class="o">*</span> <span class="n">spacing</span> <span class="o">==</span> <span class="mi">1</span>  <span class="c1"># add less than half the spacing</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<p><img alt="" src="_images/fall_left.png" /></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mi">1</span> <span class="o">+</span> <span class="mf">0.6</span> <span class="o">*</span> <span class="n">spacing</span> <span class="o">==</span> <span class="mi">1</span> <span class="c1"># add a more than half the spacing</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>False
</pre></div>
</div>
</div>
</div>
<p><img alt="" src="_images/fall_right.png" /></p>
<ul class="simple">
<li><p>We’re working with pretty small numbers here so you might not be too shocked</p></li>
<li><p>But remember, the bigger our exponent, the bigger our rounding errors will be!</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">large_number</span> <span class="o">=</span> <span class="mf">1e25</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">binary</span><span class="p">(</span><span class="n">large_number</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> Decimal: 1.03397576569128469 x 2^83
  Binary: 1.0000100010110010101000101100001010000000001010010001 x 2^1010011

    Sign: 0 (+)
Mantissa: 0000100010110010101000101100001010000000001010010001 (0.03397576569128469)
Exponent: 1010011 (83)
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>The exponent is 83 so the spacing should be:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">spacing</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="o">-</span><span class="mi">52</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="mi">83</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">spacing</span><span class="si">:</span><span class="s2">.5e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2.14748e+09
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>1 billion is less than half that spacing, so if we add it to <code class="docutils literal notranslate"><span class="pre">large_number</span></code>, we won’t cross the mountain peak, and we’ll slide back down into the same valley:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">one_billion</span> <span class="o">=</span> <span class="mf">1e9</span>
<span class="mf">1e25</span> <span class="o">+</span> <span class="n">one_billion</span> <span class="o">==</span> <span class="mf">1e25</span>  <span class="c1"># adding a billion didn&#39;t change our number!</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>2 billion is more than half that spacing, so if we add it to <code class="docutils literal notranslate"><span class="pre">large_number</span></code>, we’ll slide into the next valley (representable number):</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">two_billion</span> <span class="o">=</span> <span class="mf">2e9</span>
<span class="mf">1e25</span> <span class="o">+</span> <span class="n">two_billion</span> <span class="o">==</span> <span class="mf">1e25</span>  <span class="c1"># adding two billion (more than half the spacing) did change our number</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>False
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Another implication of having a finite amount of floating numbers to represent an infinite number system is that two numbers may share the same representation in memory</p></li>
<li><p>For example, these are all <code class="docutils literal notranslate"><span class="pre">True</span></code>:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mf">0.99999999999999999</span> <span class="o">==</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mf">1.00000000000000004</span> <span class="o">==</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mf">1.00000000000000009</span> <span class="o">==</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>This is pretty intuitive is you think about the “Floating Point Mountain Range”</p></li>
<li><p>No matter what number you are, if you don’t pass over the peak to your left or right, you’ll roll back down to the valley!</p></li>
<li><p>And also remember, the bigger the number, the bigger the spacing/rounding errors!</p></li>
</ul>
<p><img alt="" src="_images/mountains.png" /></p>
</section>
</section>
<section id="lecture-exercise-fun-with-floating-points">
<h2>7. Lecture Exercise: Fun with Floating Points<a class="headerlink" href="#lecture-exercise-fun-with-floating-points" title="Link to this heading">#</a></h2>
<hr><section id="floating-point-range">
<h3>7.1. Floating Point Range<a class="headerlink" href="#floating-point-range" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Recall that most compute environments you’ll encounter will be using IEEE double precision (<code class="docutils literal notranslate"><span class="pre">float64</span></code>), so 53 bits for the mantissa, 11 for the exponent.</p></li>
<li><p>So let’s calculate the biggest possible floating point number based on this scheme.</p></li>
<li><p>Recall that if we have 11 bits for the exponent then the <strong>signed range</strong> of possible values is: <span class="math notranslate nohighlight">\(-2^{N-1}\)</span> to <span class="math notranslate nohighlight">\(2^{N-1}-1\)</span>, and the largest value is:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bits</span> <span class="o">=</span> <span class="mi">11</span>
<span class="n">max_exponent</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="n">bits</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
<span class="n">max_exponent</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1023
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>For <code class="docutils literal notranslate"><span class="pre">float64</span></code> the maximum mantissa can be calculated as the sum of all 52 bits from (<span class="math notranslate nohighlight">\(2^{-1}\)</span> to <span class="math notranslate nohighlight">\(2^{-52}\)</span>):</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">max_mantissa</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">**</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">53</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">max_mantissa</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.9999999999999998
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Therefore the maximum float we can represent is (remember our format is <span class="math notranslate nohighlight">\(1.M \times 2 ^ E\)</span>):</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">max_mantissa</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">max_exponent</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.7976931348623157e+308
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Let’s confirm using the <code class="docutils literal notranslate"><span class="pre">numpy</span></code> function <code class="docutils literal notranslate"><span class="pre">np.finfo()</span></code>:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span><span class="o">.</span><span class="n">max</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.7976931348623157e+308
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Looks good to me!</p></li>
<li><p>What happens if we try to make a number bigger than this?</p></li>
</ul>
<div class="cell tag_raises-exception docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mi">10</span> <span class="o">**</span> <span class="mf">309.0</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">OverflowError</span><span class="g g-Whitespace">                             </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">47</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="mi">10</span> <span class="o">**</span> <span class="mf">309.0</span>

<span class="ne">OverflowError</span>: (34, &#39;Result too large&#39;)
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Or in <code class="docutils literal notranslate"><span class="pre">numpy</span></code>, it throws a warning and defaults to <code class="docutils literal notranslate"><span class="pre">inf</span></code>:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mf">309.0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\mathp\AppData\Local\Temp\ipykernel_20776\705321107.py:1: RuntimeWarning:

overflow encountered in power
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>inf
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Now let’s do the minimum value</p></li>
<li><p>The minimum value will be the minimum mantissa multiplied by the minimum exponent</p></li>
<li><p>The minimum mantissa is 0 (all bits sets to 0)</p></li>
<li><p>You might think the minimum exponent is <span class="math notranslate nohighlight">\(-2^{10}=-1024\)</span> just as we’ve discussed through this lecture, but there are some bit patterns reserved for “special numbers” (like 0) which effectively reduce the minimum exponent to <span class="math notranslate nohighlight">\(-1022\)</span> (this is not important to know but you can read more <a class="reference external" href="https://people.orie.cornell.edu/snp32/orie_6125/ieee754/ieee754.html">here</a>)</p></li>
<li><p>So the minimum value is actually:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mf">1.0</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">**</span> <span class="o">-</span><span class="mi">1022</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2.2250738585072014e-308
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>You don’t need to worry about this derivation too much, after all <code class="docutils literal notranslate"><span class="pre">numpy</span></code> can help!</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span><span class="o">.</span><span class="n">minexp</span>  <span class="c1"># minimum exponent value</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-1022
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span><span class="o">.</span><span class="n">tiny</span>  <span class="c1"># smallest possible positive value</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2.2250738585072014e-308
</pre></div>
</div>
</div>
</div>
</section>
<section id="optional-7-1-1-subnormal-numbers">
<h3>(Optional) 7.1.1 Subnormal Numbers<a class="headerlink" href="#optional-7-1-1-subnormal-numbers" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>What happens if we try to store a number smaller than the above?</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mi">2</span> <span class="o">**</span> <span class="o">-</span><span class="mi">1024</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>5.562684646268003e-309
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Um, it worked… 🤔</p></li>
<li><p>Remember how I discussed “special cases” earlier? One of these is “<a class="reference external" href="https://en.wikipedia.org/wiki/Denormal_number">subnormal numbers</a>”</p></li>
<li><p>This is well beyond the scope of the course, but briefly, subnormal numbers help us fill the gap between 0 and <span class="math notranslate nohighlight">\(2^{-1022}\)</span></p></li>
<li><p>If the exponent is set to it’s minimum value, then we can play with our bits (that’s not meant to sound dirty), and instead of the mantissa starting with a 1, we can start it with a 0</p></li>
<li><p>This gives our mantissa a minimum value of <span class="math notranslate nohighlight">\(2^{-52}\)</span> (rather than 1, which is what we had before)</p></li>
<li><p>So the smallest subnormal number we can have is <span class="math notranslate nohighlight">\(2^{-52} \times 2 ^ {-1022} = 2 ^ {-1074}\)</span>:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mi">2</span> <span class="o">**</span> <span class="o">-</span><span class="mi">1074</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>5e-324
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Anything less than this is rounded to 0:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mi">2</span> <span class="o">**</span> <span class="o">-</span><span class="mi">1075</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>5e-324
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>You can read more <a class="reference external" href="https://people.orie.cornell.edu/snp32/orie_6125/ieee754/ieee754.html#subnormal-numbers">in this article</a> and this <a class="reference external" href="https://stackoverflow.com/a/14002396/14179508">stackoverflow post</a>, but as I said, this is beyond the scope of the course.</p></li>
</ul>
</section>
<section id="order-of-operations">
<h3>7.2. Order of Operations<a class="headerlink" href="#order-of-operations" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Consider the following:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mf">1e16</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="mf">1e16</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>False
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>What’s up with that?</p></li>
<li><p>Let’s break it down…</p></li>
<li><p>First the spacing of <code class="docutils literal notranslate"><span class="pre">1e16</span></code> is:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">calc_spacing</span><span class="p">(</span><span class="mf">1e16</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2.0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mf">1e16</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="mf">1e16</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>So the above should make sense, we aren’t adding more than half the spacing, so we remain at <code class="docutils literal notranslate"><span class="pre">1e16</span></code></p></li>
<li><p>But what about this:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mf">1e16</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mf">1e16</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>False
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>This time we added <code class="docutils literal notranslate"><span class="pre">(1</span> <span class="pre">+</span> <span class="pre">1)</span></code>, which is <code class="docutils literal notranslate"><span class="pre">2</span></code>, and we got a <code class="docutils literal notranslate"><span class="pre">False</span></code> as expected</p></li>
<li><p>But now let’s remove the parentheses:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mf">1e16</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="mf">1e16</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Back to <code class="docutils literal notranslate"><span class="pre">True</span></code>, what’s going on…</p></li>
<li><p>Well we have an “order of operations” here, the <code class="docutils literal notranslate"><span class="pre">1e16</span> <span class="pre">+</span> <span class="pre">1</span></code> happens first, which is just <code class="docutils literal notranslate"><span class="pre">1e16</span></code>, and then we try add <code class="docutils literal notranslate"><span class="pre">1</span></code> again but the same thing happens</p></li>
<li><p>What do you think will happen with this one?</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="mf">1e16</span> <span class="o">==</span> <span class="mf">1e16</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>False
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>This time, the <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">+</span> <span class="pre">1</span></code> happened first, which is <code class="docutils literal notranslate"><span class="pre">2</span></code>, and then we add <code class="docutils literal notranslate"><span class="pre">1e16</span></code></p></li>
</ul>
</section>
<section id="writing-functions">
<h3>7.3. Writing Functions<a class="headerlink" href="#writing-functions" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Later in this course we’ll create a Logistic Regression model from scratch and you’ll have to calculate something that looks like:</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\log(1+\exp(z))\]</div>
<ul class="simple">
<li><p>Looks pretty harmless right?</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">log_1_plus_exp</span><span class="p">(</span><span class="n">z</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>But what happens if <code class="docutils literal notranslate"><span class="pre">z</span></code> is large? Say, 1000:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">log_1_plus_exp</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\mathp\AppData\Local\Temp\ipykernel_20776\2578511584.py:2: RuntimeWarning:

overflow encountered in exp
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>inf
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>We get an overflow error when <code class="docutils literal notranslate"><span class="pre">z</span></code> in <code class="docutils literal notranslate"><span class="pre">exp(z)</span></code> is large!</p></li>
<li><p>In fact, we can find out what the limit of <code class="docutils literal notranslate"><span class="pre">z</span></code> is:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">max_float</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span><span class="o">.</span><span class="n">max</span>
<span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">max_float</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>709.782712893384
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>If we pass anything bigger than that into <code class="docutils literal notranslate"><span class="pre">np.exp()</span></code> we’ll get an overflow error</p></li>
<li><p>However, you might know that for <span class="math notranslate nohighlight">\(z &gt;&gt; 1\)</span>:</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\log(1+\exp(z))\approx \log(\exp(z)) = z\]</div>
<ul class="simple">
<li><p>e.g.:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100.0
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>We can use this to account for the overflow error:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@np</span><span class="o">.</span><span class="n">vectorize</span>  <span class="c1"># decorator to vectorize the function</span>
<span class="k">def</span> <span class="nf">log_1_plus_exp_safe</span><span class="p">(</span><span class="n">z</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">z</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Avoiding overflow error with approximation of </span><span class="si">{</span><span class="n">z</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">!&quot;</span><span class="p">)</span>        
        <span class="k">return</span> <span class="n">z</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">log_1_plus_exp_safe</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">500</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Avoiding overflow error with approximation of 200!
Avoiding overflow error with approximation of 500!
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([  1.31326169,  10.0000454 , 200.        , 500.        ])
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Cool! We combined math + CS + our brains to write better code! You’ll explore this more in Lab 1</p></li>
<li><p>But note that this is part of the reason we use libraries like <code class="docutils literal notranslate"><span class="pre">numpy</span></code>, <code class="docutils literal notranslate"><span class="pre">scipy</span></code>, <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code>, etc. They’ve taken care of all of this for you!</p></li>
</ul>
</section>
<section id="precision-vs-memory-vs-speed">
<h3>7.4. Precision vs Memory vs Speed<a class="headerlink" href="#precision-vs-memory-vs-speed" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>So double precision floats are pretty standard and require 64 bits to store:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">()</span><span class="o">.</span><span class="n">nbytes</span>  <span class="c1"># number of bytes consumed by a float64</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>8
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">()</span><span class="o">.</span><span class="n">nbytes</span> <span class="o">*</span> <span class="mi">8</span>  <span class="c1"># recall 1 byte = 8 bits</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>64
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>When dealing with huge datasets or models with millions or billions of parameters it may be desirable to lower the precision of our numbers to use less memory and/or gain speed</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x64</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;array size: </span><span class="si">{</span><span class="n">x64</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;array type: </span><span class="si">{</span><span class="n">x64</span><span class="o">.</span><span class="n">dtype</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;mem. usage: </span><span class="si">{</span><span class="n">x64</span><span class="o">.</span><span class="n">nbytes</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="mi">1000</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1000</span><span class="p">)</span><span class="si">}</span><span class="s2"> MB&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array size: (1000, 1000)
array type: float64
mem. usage: 64.0 MB
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x32</span> <span class="o">=</span> <span class="n">x64</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;array type: </span><span class="si">{</span><span class="n">x32</span><span class="o">.</span><span class="n">dtype</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;mem. usage: </span><span class="si">{</span><span class="n">x32</span><span class="o">.</span><span class="n">nbytes</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="mi">1000</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1000</span><span class="p">)</span><span class="si">}</span><span class="s2"> MB&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array type: float32
mem. usage: 32.0 MB
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Below I’m squaring the elements of my two arrays. They have the same number of elements, but different data types - let’s observe the difference in the speed of the operation:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">time64</span> <span class="o">=</span> <span class="o">%</span><span class="k">timeit</span> -q -o -r 3 x64 ** 2
<span class="n">time32</span> <span class="o">=</span> <span class="o">%</span><span class="k">timeit</span> -q -o -r 3 x32 ** 2
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;float32 array is </span><span class="si">{</span><span class="n">time64</span><span class="o">.</span><span class="n">average</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">time32</span><span class="o">.</span><span class="n">average</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">x faster than float64 array here.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>float32 array is 2.37x faster than float64 array here.
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>I’m showing you this as foreboding for later topics dealing with memory and deep neural networks, where we’ll use these ideas of precision vs speed to optimize our models!</p></li>
</ul>
<p><img alt="" src="_images/foreboding.png" /></p>
</section>
</section>
<section id="the-lecture-in-three-conjectures">
<h2>8. The Lecture in Three Conjectures<a class="headerlink" href="#the-lecture-in-three-conjectures" title="Link to this heading">#</a></h2>
<hr><ol class="arabic simple">
<li><p>Most fractional numbers are not represented exactly by floating point numbers in computers which can lead to rounding errors.</p></li>
<li><p>Most compute environments you’ll encounter will use IEEE double precision… but others do exist (especially single precision). Some software will require you to use a particular data type due to computational limitations (for example, PyTorch sometimes forces you to use float32 instead of float64).</p></li>
<li><p>There is a biggest and smallest floating point number (depending on precision), beyond these we get overflow or underflow errors. Use <code class="docutils literal notranslate"><span class="pre">np.nextafter()</span></code> and <code class="docutils literal notranslate"><span class="pre">numpy.finfo()</span></code> to work out float spacing and ranges.</p></li>
</ol>
<p><img alt="" src="_images/mission.png" /></p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="lecture0_introduction.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Introduction to the Course</p>
      </div>
    </a>
    <a class="right-next"
       href="lecture2_1_regression.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Regression</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lecture-outline">Lecture Outline</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lecture-learning-objectives">Lecture Learning Objectives</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">Imports</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#floating-point-errors">1. Floating Point Errors</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#binary-numbers-and-integers">2. Binary Numbers and Integers</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fractional-numbers-in-binary">3. Fractional Numbers in Binary</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fixed-point-numbers">4. Fixed Point Numbers</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">5. Floating Point Numbers</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#floating-point-standard">5.1. Floating Point Standard</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#spacing-and-rounding-errors">6. Spacing and Rounding Errors</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ingredient-1-rounding-errors">6.1. Ingredient 1: Rounding Errors</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ingredient-2-spacing">6.2. Ingredient 2: Spacing</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lecture-exercise-fun-with-floating-points">7. Lecture Exercise: Fun with Floating Points</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#floating-point-range">7.1. Floating Point Range</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#optional-7-1-1-subnormal-numbers">(Optional) 7.1.1 Subnormal Numbers</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#order-of-operations">7.2. Order of Operations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#writing-functions">7.3. Writing Functions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#precision-vs-memory-vs-speed">7.4. Precision vs Memory vs Speed</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-lecture-in-three-conjectures">8. The Lecture in Three Conjectures</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Mahmood Amintoosi
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024. CC0 Licensed - Computer Science Dept., Ferdowsi University of Mashhad.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>